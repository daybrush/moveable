/*
Copyright (c) Daybrush
name: @moveable/helper
license: MIT
author: Daybrush
repository: https://github.com/daybrush/moveable/blob/master/packages/helper
version: 0.1.3
*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).MoveableHelper=n()}(this,(function(){"use strict";var t=function(n,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])},t(n,r)};function n(n,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function e(){this.constructor=n}t(n,r),n.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)}function r(t,n){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var e,i,o=r.call(t),u=[];try{for(;(void 0===n||n-- >0)&&!(e=o.next()).done;)u.push(e.value)}catch(t){i={error:t}}finally{try{e&&!e.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return u}function e(t,n,r){if(r||2===arguments.length)for(var e,i=0,o=n.length;i<o;i++)!e&&i in n||(e||(e=Array.prototype.slice.call(n,0,i)),e[i]=n[i]);return t.concat(e||Array.prototype.slice.call(n))}function i(t){return Array.isArray(t)}function o(t){return t.reduce((function(t,n){return i(n)?t.push.apply(t,o(n)):t.push(n),t}),[])}var u=function(){function t(t){this.parent=t,this.type="single",this.depth=0,this._scope=[],t&&(this.depth=t.depth+1)}return Object.defineProperty(t.prototype,"scope",{get:function(){var t=this.parent;return t&&"root"!==t.type?e(e([],r(t.scope),!1),[t.id],!1):[]},enumerable:!1,configurable:!0}),t}(),a=function(t){function r(n,r){var e=t.call(this,n)||this;return e.value=r,e.type="single",e.isGroupElement=!1,e}return n(r,t),r}(u),f=function(t){function u(){var n=null!==t&&t.apply(this,arguments)||this;return n.type="group",n.value=[],n.id="",n.groupElement=null,n.map=new Map,n}return n(u,t),u.prototype.compare=function(t,n){void 0===n&&(n=0);var r=o(t),e=this.map,i=r.length,u=e.size,a=u-i,f=r.filter((function(t){return e.has(t)})).length;return n>0&&a>=0||0===n&&0===a?i===f:n<0&&a<=0&&u===f},u.prototype.has=function(t){return this.map.has(t)},u.prototype.contains=function(t){return!!this.has(t)||this.value.some((function(n){return"group"===n.type&&n.contains(t)}))},u.prototype.findContainedChild=function(t){return n=this.value,e=function(t,n,r){void 0===r&&(r=-1);for(var e=t.length,i=0;i<e;++i)if(n(t[i],i,t))return i;return r}(n,(function(n){return"single"===n.type?n.value===t:n.contains(t)})),e>-1?n[e]:r;var n,r,e},u.prototype.findExactChild=function(t){var n=this.map;if(!i(t))return n.get(t);var r=o(t),e=r.length,u=n.get(r[0]);if(u)for(var a=u.parent;a;){if(a.map.size>=e)return a;a=a.parent}},u.prototype.findCommonParent=function(t){var n=this,r=1/0,e=t.map((function(t){return n.findExactChild(t)}));e.forEach((function(t){t&&(r=Math.min(t.depth,r))}));for(var i=function(){--r;var t=(e=e.map((function(t){for(var n=t;n&&n.depth!==r;)n=n.parent;return n}))).find((function(t){return t}));return t?e.every((function(n){return!n||n===t}))?"break":void 0:{value:o}},o=this;r;){var u=i();if("object"==typeof u)return u.value;if("break"===u)break}return e.find((function(t){return t}))||this},u.prototype.findNextChild=function(t,n,r){var e=this;void 0===n&&(n=this.toTargetGroups()),void 0===r&&(r=!0);var o=null,u=n.length;return n.some((function(n){if(!r&&1===u&&i(n))return o=e.findNextChild(t,n);var a=e.findExactChild(n);return a&&"map"in a&&a.map.has(t)?(o=a,!0):void 0})),o},u.prototype.findNextExactChild=function(t,n,r){void 0===r&&(r=this.toTargetGroups());var e=this.findNextChild(t,r,!0);return e&&e.compare(n,-1)?e:null},u.prototype.findPureChild=function(t,n){var r=this,e=null,i=n.filter((function(t){return r.has(t)}));return i.length?(this.value.some((function(n){if("single"!==n.type&&n.has(t)&&(e=n.findPureChild(t,i)))return!0})),e):this},u.prototype.findNextPureChild=function(t,n){var r=this.findNextChild(t);return r?r.findPureChild(t,n):null},u.prototype.getSingleChild=function(){var t,n=this.groupElement;if(n){var r=null===(t=this.parent)||void 0===t?void 0:t.value.find((function(t){return t.value===n}));if(r)return r}return null},u.prototype.toTargetGroups=function(){return this.value.map((function(t){return"single"===t.type?t.value:t.toTargetGroups()}))},u.prototype.findArrayChild=function(t){var n=this.value,r=!1;if("root"!==this.type&&(r=n.every((function(n){return"single"===n.type?t.some((function(t){return n.value===t})):t.some((function(t){return i(t)&&n.findArrayChild(t)}))}))),r&&t.length===n.length)return this;var e=null;return n.some((function(n){if("group"===n.type)return e=n.findArrayChild(t)})),e},u.prototype.groupByPerfect=function(t){return this.value.filter((function(n){return"single"!==n.type?n.compare(t,-1):t.indexOf(n.value)>-1})).map((function(t){if("single"!==t.type){var n=t.getSingleChild();if(n)return n}return t}))},u.prototype.add=function(t){var n=this,o=this.value,f=this.map;return t.forEach((function(t){if("groupId"in t)(r=new u(n)).id=t.groupId,o.push(r),r.add(t.children);else if(i(t)){var r=new u(n);o.push(r),r.add(t)}else{var e="current"in t?t.current:t,l=new a(n,e);o.push(l),f.set(e,l)}})),o.forEach((function(t){"single"===t.type?f.set(t.value,t):t.map.forEach((function(t,n){f.set(n,t)}))})),o.forEach((function(t){if("single"===t.type){var n=t.value,i=o.find((function(t){if("single"!==t.type){var i=e([],r(t.map.keys()),!1)[0];if(i)return n.contains(i)}}));t.isGroupElement=!!i,i&&(i.groupElement=t.value)}})),parent},u}(u);function l(t){function n(t){void 0===t&&(t=[]);var r=[];return t.forEach((function(t){"single"===t.type?r.push(t.value):r.push(n(t.value))})),r}return{raw:function(){return t},targets:function(){return n(this.raw())},flatten:function(){return o(this.targets())}}}var p=function(t){function u(n,r){var e=t.call(this)||this;return e.type="root",e._targets=[],e.set(n,r),e}return n(u,t),u.prototype.set=function(t,n){var r=this;void 0===n&&(n=[]),this.map=new Map,this.value=[];var e=this.map,i=this.value;this.add(t),n.forEach((function(t){if(!e.has(t)){var n=new a(r,t);n.depth=1,i.push(n),e.set(t,n)}})),this._targets=n},u.prototype.selectSubChilds=function(t,n){var r=this.findNextChild(n,t,!1),e=this.map.get(n);return l(r?[r]:e?[e]:[])},u.prototype.selectSingleChilds=function(t,n,i){var o=e([],r(t),!1);return i.forEach((function(t){var n=o.indexOf(t);n>-1&&o.splice(n,1)})),n.forEach((function(t){o.push(t)})),l(this.toChilds(o))},u.prototype.selectCompletedChilds=function(t,n,u,a){var f=this,p=e([],r(t),!1),s=o(p);return u.forEach((function(t){var n=p.indexOf(t);if(n>-1)p.splice(n,1);else{var r=a?f.findNextChild(t,p):f.findNextExactChild(t,u,p);if(r){var e=p.findIndex((function(t){return i(t)&&r.compare(t)}));e>-1&&p.splice(e,1)}}})),n.forEach((function(t){var n=f._findParentGroup(t,s).findContainedChild(t);if("group"!==(null==n?void 0:n.type))p.push(t);else{var r=n.getSingleChild();r?p.push(r.value):p.push(n.toTargetGroups())}})),l(this.toChilds(p))},u.prototype.selectSameDepthChilds=function(t,n,o,u){var a=e([],r(t),!1),f=this.findCommonParent(a);return o.forEach((function(t){var n=a.indexOf(t);if(n>-1)a.splice(n,1);else{var r=u?f.findNextExactChild(t,o,a):f.findNextChild(t,a,!0);if(r){var e=a.findIndex((function(t){return i(t)&&r.compare(t)}));e>-1&&a.splice(e,1)}}})),f.groupByPerfect(n).forEach((function(t){if("single"===t.type)a.push(t.value);else{var n=a.findIndex((function(n){return i(n)&&t.compare(n,1)}));n>-1&&a.splice(n,1),a.push(t.toTargetGroups())}})),l(this.toChilds(a))},u.prototype.toChilds=function(t){var n=this,r=[];return t.forEach((function(t){if(i(t)){var e=n.findArrayChild(t);if(e){var o=e.getSingleChild();if(o)return o;r.push(e)}}else{var u=n.map.get(t);u?r.push(u):r.push(new a(n,t))}})),r},u.prototype.findChild=function(t,n){var r=this.map.get(t);return n?r||new a(this,t):r},u.prototype.findArrayChildById=function(t){var n=null;return this.value.some((function r(e){if("single"!==e.type)return e.id===t?(n=e,!0):e.value.some(r)})),n},u.prototype.group=function(t,n){var r=this,e=this.findCommonParent(t),u=t.map((function(t){return i(t)?r.findArrayChild(t):r.findChild(t)}));if(!u.every((function(t){return(null==t?void 0:t.parent)===e})))return null;var a=new f(e),l=e.value.filter((function(t){return-1===u.indexOf(t)}));return l.length?(l.unshift(a),a.add(n?o(t):t),e.value=l,this.set(this.toTargetGroups(),this._targets),a.toTargetGroups()):null},u.prototype.ungroup=function(t){var n=this;1===t.length&&i(t[0])&&(t=t[0]);var o=this.findCommonParent(t),u=t.map((function(t){return i(t)?n.findArrayChild(t):n.findChild(t)}));if(o.groupElement)return null;if(!o.value.every((function(t){return u.indexOf(t)>-1}))||o===this)return null;var a=o.parent;if(!a)return null;var f=a.value.filter((function(t){return t!==o}));return f.push.apply(f,e([],r(o.value),!1)),a.value=f,this.set(this.toTargetGroups(),this._targets),o.toTargetGroups()},u.prototype._findParentGroup=function(t,n){if(!n.length)return this;var r=this.map.get(t);if(!r)return this;for(var e=r.parent;e;){if(n.some((function(t){return e.contains(t)})))return e;e=e.parent}return this},u}(f);return{__proto__:null,ArrayChild:f,Child:u,GroupManager:p,SingleChild:a,toTargetList:l}}));
//# sourceMappingURL=helper.min.js.map
