{"version":3,"file":"moveable.esm.js","sources":["../src/InnerMoveable.tsx","../src/consts.ts","../src/MoveableManager.tsx","../src/Moveable.tsx","../src/utils.ts"],"sourcesContent":["import * as React from \"react\";\nimport Moveable from \"react-moveable\";\nimport { ref } from \"framework-utils\";\n\nexport default class InnerMoveable extends React.Component<any> {\n    public state: any = {};\n    public moveable!: Moveable;\n    constructor(props: any) {\n        super(props);\n        this.state = this.props;\n    }\n    public render(): React.ReactNode {\n        return <Moveable ref={ref(this, \"moveable\")} {...this.state} />;\n    }\n}\n","import {\n    MOVEABLE_PROPS,\n    MOVEABLE_METHODS,\n    MOVEABLE_EVENTS,\n} from \"react-moveable\";\n\nexport const PROPERTIES: string[] = MOVEABLE_PROPS;\nexport const METHODS: string[] = MOVEABLE_METHODS;\nexport const EVENTS: string[] = MOVEABLE_EVENTS;\n","import { ref, Properties } from \"framework-utils\";\nimport * as React from \"react\";\nimport { renderSelf, ContainerProvider } from \"croact\";\nimport InnerMoveable from \"./InnerMoveable\";\nimport {\n    MoveableInterface,\n    MoveableOptions, MoveableProperties,\n} from \"react-moveable/types\";\nimport { camelize, getDocument, isArray } from \"@daybrush/utils\";\nimport { MoveableEventsParameters } from \"./types\";\nimport { PROPERTIES, EVENTS, METHODS } from \"./consts\";\nimport EventEmitter from \"@scena/event-emitter\";\n/**\n * Moveable is Draggable! Resizable! Scalable! Rotatable!\n * @sort 1\n * @alias Moveable\n * @extends EventEmitter\n */\n@Properties(METHODS, (prototype, property) => {\n    if (prototype[property]) {\n        return;\n    }\n    prototype[property] = function(...args: any[]) {\n        const self = this.getMoveable();\n\n        if (!self || !self[property]) {\n            return;\n        }\n        return self[property](...args);\n    };\n})\n@Properties(PROPERTIES, (prototype, property) => {\n    Object.defineProperty(prototype, property, {\n        get() {\n            return this.getMoveable().props[property];\n        },\n        set(value) {\n            this.setState({\n                [property]: value,\n            });\n        },\n        enumerable: true,\n        configurable: true,\n    });\n})\nclass MoveableManager extends EventEmitter<MoveableEventsParameters> {\n    private innerMoveable!: InnerMoveable | null;\n    private containerProvider: ContainerProvider | null = null;\n    private selfElement: HTMLElement | null = null;\n    private _warp = false;\n    /**\n     *\n     */\n    constructor(parentElement: HTMLElement, options: MoveableOptions = {}) {\n        super();\n        const nextOptions = { ...options };\n\n        const events: any = {};\n\n        EVENTS.forEach(name => {\n            events[camelize(`on ${name}`)] = (e: any) => this.trigger<any>(name, e);\n        });\n        let selfElement!: HTMLElement;\n\n        if (options.warpSelf) {\n            delete options.warpSelf;\n            this._warp = true;\n            selfElement = parentElement;\n        } else {\n            selfElement = getDocument(parentElement).createElement(\"div\");\n            parentElement.appendChild(selfElement);\n        }\n        this.containerProvider = renderSelf(\n            <InnerMoveable\n                ref={ref(this, \"innerMoveable\")}\n                {...nextOptions}\n                {...events}\n            /> as any,\n            selfElement,\n        );\n\n        this.selfElement = selfElement;\n        const target = nextOptions.target!;\n        if (isArray(target) && target.length > 1) {\n            this.updateRect();\n        }\n    }\n    public setState(state: Partial<MoveableOptions>, callback?: () => any) {\n        this.innerMoveable!.setState(state, callback);\n    }\n    public forceUpdate(callback?: () => any) {\n        this.innerMoveable!.forceUpdate(callback);\n    }\n    public dragStart(e: MouseEvent | TouchEvent, target: EventTarget | null = e.target) {\n        const innerMoveable = this.innerMoveable;\n        if ((innerMoveable as any).$_timer) {\n            this.forceUpdate();\n        }\n        this.getMoveable().dragStart(e, target);\n    }\n    public destroy() {\n        const selfElement = this.selfElement!;\n\n        renderSelf(\n            null,\n            selfElement!,\n            this.containerProvider,\n        );\n        if (!this._warp) {\n            selfElement?.parentElement?.removeChild(selfElement);\n        }\n        this.containerProvider = null;\n\n        this.off();\n        this.selfElement = null;\n        this.innerMoveable = null;\n    }\n    private getMoveable() {\n        return this.innerMoveable!.moveable;\n    }\n}\n\ninterface MoveableManager extends MoveableInterface, MoveableProperties {\n}\n\nexport default MoveableManager;\n","import MoveableManager from \"./MoveableManager\";\n\nexport default class Moveable extends MoveableManager {}\n","import { Able, DefaultProps } from \"react-moveable/types\";\nimport { getElementInfo as getElementInfoFunction, makeAble as makeAbleFunction } from \"react-moveable\";\n\nexport function getElementInfo(\n    target: SVGElement | HTMLElement,\n    container?: SVGElement | HTMLElement | null,\n    rootContainer?: SVGElement | HTMLElement | null | undefined,\n) {\n    return getElementInfoFunction(target, container, rootContainer);\n};\nexport function makeAble<\n    Name extends string,\n    AbleObject extends Partial<Able<any, any>>,\n>(name: Name, able: AbleObject) {\n    return makeAbleFunction<Name, AbleObject>(name, able);\n}\n"],"names":["InnerMoveable","_super","__extends","props","_this","call","state","render","React","Moveable","__assign","ref","Component","PROPERTIES","MOVEABLE_PROPS","METHODS","MOVEABLE_METHODS","EVENTS","MOVEABLE_EVENTS","MoveableManager","parentElement","options","containerProvider","selfElement","_warp","nextOptions","events","forEach","name","camelize","concat","e","trigger","warpSelf","getDocument","createElement","appendChild","renderSelf","target","isArray","length","updateRect","setState","callback","innerMoveable","forceUpdate","dragStart","$_timer","getMoveable","destroy","_a","removeChild","off","moveable","__decorate","Properties","prototype","property","args","_i","arguments","self","Object","defineProperty","get","set","value","enumerable","configurable","EventEmitter","getElementInfo","container","rootContainer","getElementInfoFunction","makeAble","able","makeAbleFunction"],"mappings":"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"}